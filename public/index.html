 <!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SafeSpace</title>

<script src="https://cdn.tailwindcss.com"></script>

<style>
.handwritten { font-family: 'Comic Sans MS', cursive; }
.note-card { 
  animation: popIn 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards; 
  transition: all 0.3s ease; 
}
.note-card:hover { 
  transform: scale(1.05) rotate(0deg) !important; 
  z-index: 10; 
}
</style>
</head>

<body class="min-h-screen flex flex-col bg-gray-50">

<nav class="bg-white shadow-sm sticky top-0 z-50">
  <div class="max-w-6xl mx-auto px-4 py-4 flex justify-between items-center">
    <div class="flex items-center gap-2">
      <span class="text-2xl">üå±</span>
      <h1 class="font-bold text-indigo-600 text-xl">SafeSpace</h1>
    </div>
    <button class="text-xs font-semibold text-red-500 border border-red-200 px-4 py-2 rounded-full hover:bg-red-50">
      üÜò AYUDA URGENTE
    </button>
  </div>
</nav>

<main class="flex-grow max-w-6xl mx-auto px-4 py-8 w-full">

  <div class="bg-white rounded-2xl shadow-xl p-6 mb-12 max-w-2xl mx-auto">
    <label class="block text-gray-600 font-semibold mb-3 text-center">
      ¬øQu√© tienes en mente hoy? Es totalmente an√≥nimo.
    </label>

    <textarea id="noteContent" rows="3"
      class="w-full p-4 bg-gray-50 border-2 border-dashed rounded-xl resize-none handwritten text-xl"
      placeholder="Escribe tu experiencia aqu√≠..."></textarea>

    <div class="flex flex-col sm:flex-row justify-between items-center mt-4 gap-4">
      <div class="flex gap-3" id="colorPicker">
        <button onclick="selectColor('yellow', this)" class="w-8 h-8 rounded-full bg-yellow-200 ring-2 ring-indigo-500"></button>
        <button onclick="selectColor('blue', this)" class="w-8 h-8 rounded-full bg-blue-200"></button>
        <button onclick="selectColor('pink', this)" class="w-8 h-8 rounded-full bg-pink-200"></button>
        <button onclick="selectColor('green', this)" class="w-8 h-8 rounded-full bg-green-200"></button>
      </div>

      <button onclick="postNote()" class="bg-indigo-600 text-white font-bold py-3 px-8 rounded-xl shadow-lg hover:bg-indigo-700">
        Publicar nota
      </button>
    </div>
  </div>

  <div id="wall" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-8"></div>
</main>

<script>
const API_URL = '/api';
let selectedColor = 'yellow';

const colorMap = {
  yellow: 'bg-yellow-200',
  blue: 'bg-blue-200',
  pink: 'bg-pink-200',
  green: 'bg-green-200'
};

document.addEventListener('DOMContentLoaded', fetchNotes);

async function fetchNotes() {
  const wall = document.getElementById('wall');
  wall.innerHTML = '';

  try {
    const res = await fetch(API_URL);
    const notes = await res.json();

    if (!notes.length) {
      wall.innerHTML = '<p class="col-span-full text-center text-gray-500">No hay notas a√∫n.</p>';
      return;
    }

    notes.forEach(renderNote);
  } catch {
    wall.innerHTML = '<p class="col-span-full text-center text-red-500">Error de conexi√≥n.</p>';
  }
}

function renderNote(note) {
  const el = document.createElement('div');
  const rot = (Math.random() * 4 - 2).toFixed(1);

  el.className = `note-card p-8 shadow-lg ${colorMap[note.color]} min-h-[220px]`;
  el.style.transform = `rotate(${rot}deg)`;

  el.innerHTML = `
    <p class="handwritten text-2xl text-gray-800 break-words">"${note.text}"</p>
    <div class="flex justify-between items-center mt-4 pt-4 border-t">
      <button onclick="giveLike('${note.id}', this)" class="flex items-center gap-1">
        ‚ù§Ô∏è <span>${note.likes}</span>
      </button>
      <span class="text-xs text-gray-500">${note.date}</span>
    </div>
  `;

  document.getElementById('wall').appendChild(el);
}

async function giveLike(id, btn) {
  btn.disabled = true;
  try {
    const res = await fetch(`${API_URL}/like/${id}`);
    const data = await res.json();
    if (data.success) btn.querySelector('span').textContent = data.newLikes;
  } finally {
    btn.disabled = false;
  }
}

async function postNote() {
  const textarea = document.getElementById('noteContent');
  const text = textarea.value.trim();
  if (text.length < 3) return;

  await fetch(API_URL, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ text, color: selectedColor })
  });

  textarea.value = '';
  fetchNotes();
}

function selectColor(color, btn) {
  selectedColor = color;
  document.querySelectorAll('#colorPicker button').forEach(b => b.classList.remove('ring-2','ring-indigo-500'));
  btn.classList.add('ring-2','ring-indigo-500');
}
</script>
</body>
</html>
